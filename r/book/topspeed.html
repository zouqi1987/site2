<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>A Minimal Wiki Example</title>
  <meta name="description" content="This is a minimal example of wiki using the bookdown package to write a book. The output format for this example is bookdown::gitbook.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="A Minimal Wiki Example" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of wiki using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="A Minimal Wiki Example" />
  
  <meta name="twitter:description" content="This is a minimal example of wiki using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Qi Zou">


<meta name="date" content="2018-03-14">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="intro.html">
<link rel="next" href="freq-sql.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="topspeed.html"><a href="topspeed.html"><i class="fa fa-check"></i><b>3</b> Topspeed</a><ul>
<li class="chapter" data-level="3.1" data-path="topspeed.html"><a href="topspeed.html#section-3.1"><i class="fa fa-check"></i><b>3.1</b> 极速版数据仓库</a><ul>
<li class="chapter" data-level="3.1.1" data-path="topspeed.html"><a href="topspeed.html#section-3.1.1"><i class="fa fa-check"></i><b>3.1.1</b> 极速版打码日志</a></li>
<li class="chapter" data-level="3.1.2" data-path="topspeed.html"><a href="topspeed.html#section-3.1.2"><i class="fa fa-check"></i><b>3.1.2</b> 极速版月活表(每日全量表)</a></li>
<li class="chapter" data-level="3.1.3" data-path="topspeed.html"><a href="topspeed.html#section-3.1.3"><i class="fa fa-check"></i><b>3.1.3</b> 极速版访客登录表(每日全量表)</a></li>
<li class="chapter" data-level="3.1.4" data-path="topspeed.html"><a href="topspeed.html#section-3.1.4"><i class="fa fa-check"></i><b>3.1.4</b> 极速版访客登录表(每日增量表)</a></li>
<li class="chapter" data-level="3.1.5" data-path="topspeed.html"><a href="topspeed.html#section-3.1.5"><i class="fa fa-check"></i><b>3.1.5</b> 用户类型表（每天增量表）</a></li>
<li class="chapter" data-level="3.1.6" data-path="topspeed.html"><a href="topspeed.html#section-3.1.6"><i class="fa fa-check"></i><b>3.1.6</b> 极速版用户注册信息表(每日增量表)</a></li>
<li class="chapter" data-level="3.1.7" data-path="topspeed.html"><a href="topspeed.html#section-3.1.7"><i class="fa fa-check"></i><b>3.1.7</b> 建表信息</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="topspeed.html"><a href="topspeed.html#section-3.2"><i class="fa fa-check"></i><b>3.2</b> 极速版数仓字典</a><ul>
<li class="chapter" data-level="3.2.1" data-path="topspeed.html"><a href="topspeed.html#section-3.2.1"><i class="fa fa-check"></i><b>3.2.1</b> 极速版打码日志(每日增量表)</a></li>
<li class="chapter" data-level="3.2.2" data-path="topspeed.html"><a href="topspeed.html#-1"><i class="fa fa-check"></i><b>3.2.2</b> 极速版用户注册信息表(每日增量表)</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="topspeed.html"><a href="topspeed.html#section-3.3"><i class="fa fa-check"></i><b>3.3</b> 极速版邮件调度</a></li>
<li class="chapter" data-level="3.4" data-path="topspeed.html"><a href="topspeed.html#fid"><i class="fa fa-check"></i><b>3.4</b> 极速版FID</a><ul>
<li class="chapter" data-level="3.4.1" data-path="topspeed.html"><a href="topspeed.html#section-3.4.1"><i class="fa fa-check"></i><b>3.4.1</b> 关注</a></li>
<li class="chapter" data-level="3.4.2" data-path="topspeed.html"><a href="topspeed.html#section-3.4.2"><i class="fa fa-check"></i><b>3.4.2</b> 热门</a></li>
<li class="chapter" data-level="3.4.3" data-path="topspeed.html"><a href="topspeed.html#section-3.4.3"><i class="fa fa-check"></i><b>3.4.3</b> 视频</a></li>
<li class="chapter" data-level="3.4.4" data-path="topspeed.html"><a href="topspeed.html#section-3.4.4"><i class="fa fa-check"></i><b>3.4.4</b> 页面</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="topspeed.html"><a href="topspeed.html#action"><i class="fa fa-check"></i><b>3.5</b> 极速版action</a></li>
<li class="chapter" data-level="3.6" data-path="topspeed.html"><a href="topspeed.html#section-3.6"><i class="fa fa-check"></i><b>3.6</b> 极速版互动（转评赞）</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="freq-sql.html"><a href="freq-sql.html"><i class="fa fa-check"></i><b>4</b> Freq Sql</a><ul>
<li class="chapter" data-level="4.1" data-path="freq-sql.html"><a href="freq-sql.html#push"><i class="fa fa-check"></i><b>4.1</b> push下发条数</a></li>
<li class="chapter" data-level="4.2" data-path="freq-sql.html"><a href="freq-sql.html#dau"><i class="fa fa-check"></i><b>4.2</b> DAU</a><ul>
<li class="chapter" data-level="4.2.1" data-path="freq-sql.html"><a href="freq-sql.html#dau-1"><i class="fa fa-check"></i><b>4.2.1</b> DAU</a></li>
<li class="chapter" data-level="4.2.2" data-path="freq-sql.html"><a href="freq-sql.html#dau-"><i class="fa fa-check"></i><b>4.2.2</b> Dau 补全脚本</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="freq-sql.html"><a href="freq-sql.html#section-4.3"><i class="fa fa-check"></i><b>4.3</b> 点击数</a><ul>
<li class="chapter" data-level="4.3.1" data-path="freq-sql.html"><a href="freq-sql.html#feed"><i class="fa fa-check"></i><b>4.3.1</b> 主feed的互动数</a></li>
<li class="chapter" data-level="4.3.2" data-path="freq-sql.html"><a href="freq-sql.html#section-4.3.2"><i class="fa fa-check"></i><b>4.3.2</b> 热门微博的互动数</a></li>
<li class="chapter" data-level="4.3.3" data-path="freq-sql.html"><a href="freq-sql.html#section-4.3.3"><i class="fa fa-check"></i><b>4.3.3</b> 热门微博的点击数</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="freq-sql.html"><a href="freq-sql.html#luicode"><i class="fa fa-check"></i><b>4.4</b> 首次打开按luicode</a></li>
<li class="chapter" data-level="4.5" data-path="freq-sql.html"><a href="freq-sql.html#section-4.5"><i class="fa fa-check"></i><b>4.5</b> 在线时长</a></li>
<li class="chapter" data-level="4.6" data-path="freq-sql.html"><a href="freq-sql.html#push"><i class="fa fa-check"></i><b>4.6</b> 可push库地理位置</a></li>
<li class="chapter" data-level="4.7" data-path="freq-sql.html"><a href="freq-sql.html#section-4.7"><i class="fa fa-check"></i><b>4.7</b> 用户类型</a></li>
<li class="chapter" data-level="4.8" data-path="freq-sql.html"><a href="freq-sql.html#section-4.8"><i class="fa fa-check"></i><b>4.8</b> 发博转发评论<font color=red>中位数</font></a></li>
<li class="chapter" data-level="4.9" data-path="freq-sql.html"><a href="freq-sql.html#section-4.9"><i class="fa fa-check"></i><b>4.9</b> 主要行为</a></li>
<li class="chapter" data-level="4.10" data-path="freq-sql.html"><a href="freq-sql.html#section-4.10"><i class="fa fa-check"></i><b>4.10</b> 曝光</a></li>
<li class="chapter" data-level="4.11" data-path="freq-sql.html"><a href="freq-sql.html#section-4.11"><i class="fa fa-check"></i><b>4.11</b> 点赞分享<font color=red>中位数</font></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>5</b> Applications</a><ul>
<li class="chapter" data-level="5.1" data-path="applications.html"><a href="applications.html#example-one"><i class="fa fa-check"></i><b>5.1</b> Example one</a></li>
<li class="chapter" data-level="5.2" data-path="applications.html"><a href="applications.html#example-two"><i class="fa fa-check"></i><b>5.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>6</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Minimal Wiki Example</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="topspeed" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Topspeed</h1>
<div id="section-3.1" class="section level2">
<h2><span class="header-section-number">3.1</span> 极速版数据仓库</h2>
<div id="section-3.1.1" class="section level3">
<h3><span class="header-section-number">3.1.1</span> 极速版打码日志</h3>
<p>日志传输直接入库 表临时命名为: weibo_lite_ods1</p>
</div>
<div id="section-3.1.2" class="section level3">
<h3><span class="header-section-number">3.1.2</span> 极速版月活表(每日全量表)</h3>
<pre class="shell"><code>day=`date -d &quot;1 day ago&quot; +%Y%m%d`
last_30day=`date -d &quot;30 days ago&quot; +%Y%m%d`
dt_1=`date -d &quot;2 days ago&quot; +%Y%m%d`
dt_30=`date -d &quot;31 days ago&quot; +%Y%m%d`

### 极速版月活表(每日全量表)
表临时命名为: elite_month_active</code></pre>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> t1.uid,
       t1.aid,
       t2.reg_time,
       <span class="kw">CASE</span>
           <span class="kw">WHEN</span> t3.uid <span class="kw">IS</span> <span class="kw">NULL</span>
                <span class="kw">AND</span> t4.uid <span class="kw">IS</span> <span class="kw">NULL</span>
                <span class="kw">AND</span> t1.actv_days = <span class="dv">30</span> <span class="kw">THEN</span> <span class="st">&#39;5&#39;</span>
           <span class="kw">WHEN</span> t3.uid <span class="kw">IS</span> <span class="kw">NULL</span>
                <span class="kw">AND</span> t4.uid <span class="kw">IS</span> <span class="kw">NULL</span>
                <span class="kw">AND</span> t1.actv_days &gt;= <span class="dv">25</span>
                <span class="kw">AND</span> t1.actv_days &lt;= <span class="dv">29</span> <span class="kw">THEN</span> <span class="st">&#39;4&#39;</span>
           <span class="kw">WHEN</span> t3.uid <span class="kw">IS</span> <span class="kw">NULL</span>
                <span class="kw">AND</span> t4.uid <span class="kw">IS</span> <span class="kw">NULL</span>
                <span class="kw">AND</span> t1.actv_days &gt;= <span class="dv">12</span>
                <span class="kw">AND</span> t1.actv_days &lt;= <span class="dv">24</span> <span class="kw">THEN</span> <span class="st">&#39;3&#39;</span>
           <span class="kw">WHEN</span> t3.uid <span class="kw">IS</span> <span class="kw">NULL</span>
                <span class="kw">AND</span> t4.uid <span class="kw">IS</span> <span class="kw">NULL</span>
                <span class="kw">AND</span> t1.actv_days &gt;= <span class="dv">4</span>
                <span class="kw">AND</span> t1.actv_days &lt;= <span class="dv">11</span> <span class="kw">THEN</span> <span class="st">&#39;2&#39;</span>
           <span class="kw">WHEN</span> t3.uid <span class="kw">IS</span> <span class="kw">NULL</span>
                <span class="kw">AND</span> t4.uid <span class="kw">IS</span> <span class="kw">NULL</span>
                <span class="kw">AND</span> t1.actv_days &gt;= <span class="dv">1</span>
                <span class="kw">AND</span> t1.actv_days &lt;= <span class="dv">3</span> <span class="kw">THEN</span> <span class="st">&#39;1&#39;</span>
           <span class="kw">ELSE</span> <span class="st">&#39;9&#39;</span>
       <span class="kw">END</span> <span class="kw">AS</span> actv_freq
<span class="kw">FROM</span>
    (<span class="kw">SELECT</span> <span class="fu">uid</span>,
            aid,
            <span class="fu">count</span>(dt) <span class="kw">AS</span> actv_days
     <span class="kw">FROM</span> weibo_lite_ods1
     <span class="kw">WHERE</span> dt <span class="kw">BETWEEN</span> <span class="st">&#39;${last_30day}&#39;</span> <span class="kw">AND</span> <span class="st">&#39;${day}&#39;</span>
     <span class="kw">GROUP</span> <span class="kw">BY</span> <span class="fu">uid</span>,
              aid) t1
<span class="kw">LEFT</span> <span class="kw">JOIN</span>
    (<span class="kw">SELECT</span> <span class="fu">uid</span>,
            aid,
            day_key <span class="kw">AS</span> reg_time
     <span class="kw">FROM</span> weibo_lite_ods1
     <span class="kw">WHERE</span> dt <span class="kw">BETWEEN</span> <span class="st">&#39;${last_30day}&#39;</span> <span class="kw">AND</span> <span class="st">&#39;${day}&#39;</span>
         <span class="kw">AND</span> action = <span class="st">&#39;2358&#39;</span>) t2 <span class="kw">ON</span> t1.uid = t2.uid
<span class="kw">LEFT</span> <span class="kw">JOIN</span>
    (<span class="kw">SELECT</span> guest_id <span class="kw">AS</span> <span class="fu">uid</span>
     <span class="kw">FROM</span> elite_guest_login
     <span class="kw">WHERE</span> dt <span class="kw">BETWEEN</span> <span class="st">&#39;${last_30day}&#39;</span> <span class="kw">AND</span> <span class="st">&#39;${day}&#39;</span>
         <span class="kw">AND</span> <span class="kw">MODE</span> = <span class="st">&#39;register&#39;</span>) t3 <span class="kw">ON</span> t1.uid = t3.uid
<span class="kw">LEFT</span> <span class="kw">JOIN</span>
    (<span class="kw">SELECT</span> <span class="fu">uid</span>
     <span class="kw">FROM</span> elite_reg_info
     <span class="kw">WHERE</span> dt <span class="kw">BETWEEN</span> <span class="st">&#39;${last_30day}&#39;</span> <span class="kw">AND</span> <span class="st">&#39;${day}&#39;</span>) t4 <span class="kw">ON</span> t1.uid = t4.uid
<span class="kw">GROUP</span> <span class="kw">BY</span> t1.uid,
         t1.aid,
         t2.reg_time,
         actv_freq</code></pre></div>
</div>
<div id="section-3.1.3" class="section level3">
<h3><span class="header-section-number">3.1.3</span> 极速版访客登录表(每日全量表)</h3>
<p>表临时命名为: elite_guest_login_all</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> guest_id,
       aid,
       from_val,
       init_wm
<span class="kw">FROM</span>
    (<span class="kw">SELECT</span> guest_id,
            aid,
            from_val,
            init_wm
     <span class="kw">FROM</span> elite_guest_login_all
     <span class="kw">WHERE</span> dt = <span class="st">&#39;${day}&#39;</span>
     <span class="kw">UNION</span> <span class="kw">ALL</span> <span class="kw">SELECT</span> <span class="fu">uid</span> <span class="kw">AS</span> guest_id,
                      aid,
                      from_val,
                      init_wm
     <span class="kw">FROM</span> weibo_lite_ods1
     <span class="kw">WHERE</span> dt = <span class="st">&#39;${day}&#39;</span>
         <span class="kw">AND</span> <span class="fu">length</span>(<span class="fu">uid</span>) = <span class="dv">13</span>
     <span class="kw">GROUP</span> <span class="kw">BY</span> <span class="fu">uid</span>,
              aid,
              from_val,
              init_wm) t1
<span class="kw">GROUP</span> <span class="kw">BY</span> guest_id,
         aid,
         from_val,
         init_wm</code></pre></div>
</div>
<div id="section-3.1.4" class="section level3">
<h3><span class="header-section-number">3.1.4</span> 极速版访客登录表(每日增量表)</h3>
<p>表临时命名为: elite_guest_login</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> <span class="fu">uid</span> <span class="kw">AS</span> guest_id,
       <span class="kw">MODE</span>,
       extend <span class="kw">AS</span> <span class="fu">uid</span>,
       aid,
       from_val,
       init_wm
<span class="kw">FROM</span> weibo_lite_ods1
<span class="kw">WHERE</span> dt = <span class="st">&#39;${day}&#39;</span>
    <span class="kw">AND</span> <span class="fu">length</span>(<span class="fu">uid</span>) = <span class="dv">13</span>
<span class="kw">GROUP</span> <span class="kw">BY</span> <span class="fu">uid</span>,
         <span class="kw">MODE</span>,
         extend,
         aid,
         from_val,
         init_wm</code></pre></div>
</div>
<div id="section-3.1.5" class="section level3">
<h3><span class="header-section-number">3.1.5</span> 用户类型表（每天增量表）</h3>
<p>表临时命名为: elite_user_type</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql">
<span class="kw">SELECT</span> t2.label <span class="kw">AS</span> user_type,
       t1.uid,
       t1.aid,
       t1.from_val,
       t1.wm,
       t1.init_wm
<span class="kw">FROM</span>
    (<span class="kw">SELECT</span> <span class="fu">uid</span>,
            aid,
            from_val,
            wm,
            init_wm
     <span class="kw">FROM</span> weibo_lite_ods1
     <span class="kw">WHERE</span> dt = <span class="st">&#39;${day}&#39;</span>) t1
<span class="kw">LEFT</span> <span class="kw">JOIN</span>
    (<span class="kw">SELECT</span> f.uid <span class="kw">AS</span> <span class="fu">uid</span>,
            f.gp <span class="kw">AS</span> <span class="kw">label</span>
     <span class="kw">FROM</span>
         (<span class="kw">SELECT</span> <span class="kw">CASE</span> <span class="kw">WHEN</span> d.uid <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">THEN</span> <span class="st">&#39;新户正式用户&#39;</span> <span class="kw">ELSE</span> <span class="st">&#39;召回正式用户&#39;</span> <span class="kw">END</span> <span class="kw">AS</span> gp,
                                                                                c.uid
              (<span class="kw">SELECT</span> a.uid
               <span class="kw">FROM</span>
                   (<span class="kw">SELECT</span> <span class="fu">uid</span>
                    <span class="kw">FROM</span> weibo_lite_ods1
                    <span class="kw">WHERE</span> dt = <span class="st">&#39;${day}&#39;</span>
                        <span class="kw">AND</span> <span class="fu">length</span>(<span class="fu">uid</span>)&lt;=<span class="dv">10</span>
                    <span class="kw">GROUP</span> <span class="kw">BY</span> <span class="fu">uid</span>) a
               <span class="kw">LEFT</span> <span class="kw">JOIN</span>
                   (<span class="kw">SELECT</span> <span class="fu">uid</span>
                    <span class="kw">FROM</span> elite_month_active
                    <span class="kw">WHERE</span> dt = <span class="st">&#39;${dt_1}&#39;</span>
                        <span class="kw">AND</span> <span class="fu">length</span>(<span class="fu">uid</span>) &lt;=<span class="dv">10</span>
                    <span class="kw">GROUP</span> <span class="kw">BY</span> <span class="fu">uid</span>) b <span class="kw">ON</span> a.uid = b.uid
               <span class="kw">WHERE</span> b.uid <span class="kw">IS</span> <span class="kw">NULL</span>) c
          <span class="kw">LEFT</span> <span class="kw">JOIN</span>
              (<span class="kw">SELECT</span> <span class="fu">uid</span>
               <span class="kw">FROM</span> elite_reg_info
               <span class="kw">WHERE</span> dt = <span class="st">&#39;day&#39;</span>
               <span class="kw">GROUP</span> <span class="kw">BY</span> <span class="fu">uid</span>) d <span class="kw">ON</span> c.uid = d.uid
          <span class="kw">UNION</span> <span class="kw">ALL</span> <span class="kw">SELECT</span> <span class="kw">CASE</span> <span class="kw">WHEN</span> d1.uid <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">THEN</span> <span class="st">&#39;新户访客&#39;</span> <span class="kw">ELSE</span> <span class="st">&#39;召回访客&#39;</span> <span class="kw">END</span> <span class="kw">AS</span> gp,
                                                                                       c1.uid
          <span class="kw">FROM</span>
              (<span class="kw">SELECT</span> a1.uid
               <span class="kw">FROM</span>
                   (<span class="kw">SELECT</span> w.guest_id <span class="kw">AS</span> <span class="fu">uid</span>
                    <span class="kw">FROM</span>
                        (<span class="kw">SELECT</span> guest_id
                         <span class="kw">FROM</span> elite_guest_login
                         <span class="kw">WHERE</span> dt = <span class="st">&#39;${day}&#39;</span>) w1
                    <span class="kw">LEFT</span> <span class="kw">JOIN</span>
                        (<span class="kw">SELECT</span> guest_id
                         <span class="kw">FROM</span> elite_guest_login
                         <span class="kw">WHERE</span> dt = <span class="st">&#39;${day}&#39;</span>
                             <span class="kw">AND</span> <span class="kw">MODE</span> = <span class="st">&#39;TRANS&#39;</span>) j1 <span class="kw">ON</span> w1.guest_id = j1.guest_id
                    <span class="kw">WHERE</span> j1.guest_id <span class="kw">IS</span> <span class="kw">NULL</span>) a1
               <span class="kw">LEFT</span> <span class="kw">JOIN</span>
                   (<span class="kw">SELECT</span> guest_id <span class="kw">AS</span> <span class="fu">uid</span>
                    <span class="kw">FROM</span> elite_guest_login
                    <span class="kw">WHERE</span> dt <span class="kw">BETWEEN</span> <span class="st">&#39;${dt_30}&#39;</span> <span class="kw">AND</span> <span class="st">&#39;${dt_1}&#39;</span>
                    <span class="kw">GROUP</span> <span class="kw">BY</span> guest_id) b1 <span class="kw">ON</span> a1.uid = b1.uid
               <span class="kw">WHERE</span> b1.uid <span class="kw">IS</span> <span class="kw">NULL</span>) c1
          <span class="kw">LEFT</span> <span class="kw">JOIN</span>
              (<span class="kw">SELECT</span> guest_id <span class="kw">AS</span> <span class="fu">uid</span>
               <span class="kw">FROM</span> elite_guest_login
               <span class="kw">WHERE</span> dt = <span class="st">&#39;${day}&#39;</span>
                   <span class="kw">AND</span> MODE=<span class="st">&#39;REGISTER&#39;</span>
               <span class="kw">GROUP</span> <span class="kw">BY</span> guest_id) d1 <span class="kw">ON</span> c1.uid = d1.uid) f
     <span class="kw">GROUP</span> <span class="kw">BY</span> f.gp,
              f.uid) t2 <span class="kw">ON</span> t1.uid = t2.uid</code></pre></div>
</div>
<div id="section-3.1.6" class="section level3">
<h3><span class="header-section-number">3.1.6</span> 极速版用户注册信息表(每日增量表)</h3>
<p>表临时命名为: elite_reg_info</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> <span class="fu">uid</span>,
       aid,
       day_key <span class="kw">AS</span> reg_time
<span class="kw">FROM</span> weibo_lite_ods1
<span class="kw">WHERE</span> dt = <span class="st">&#39;${day}&#39;</span> <span class="kw">AND</span> action = <span class="st">&#39;2358&#39;</span></code></pre></div>
</div>
<div id="section-3.1.7" class="section level3">
<h3><span class="header-section-number">3.1.7</span> 建表信息</h3>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql">dbConnect(MySQL(), <span class="fu">user</span> = <span class="ot">&quot;root&quot;</span>, <span class="kw">password</span> = <span class="ot">&quot;1qaz2wsxQWE&quot;</span>, dbname = <span class="ot">&quot;wbapp_ugda&quot;</span>, port = <span class="dv">3306</span>, host = <span class="ot">&quot;10.77.39.132&quot;</span>)

| dip_topspeed | <span class="kw">CREATE</span> <span class="kw">TABLE</span> `dip_topspeed` (
  `id` <span class="dt">int</span>(<span class="dv">11</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> AUTO_INCREMENT,
  `dau` bigint(<span class="dv">20</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,
  `refresh_uv` bigint(<span class="dv">20</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,
  `switch_uv` bigint(<span class="dv">20</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,
  `refresh_pv` bigint(<span class="dv">20</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,
  `switch_pv` bigint(<span class="dv">20</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,
  <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (`id`)
) ENGINE=MyISAM <span class="kw">DEFAULT</span> CHARSET=utf8 


<span class="co">---dau</span>
<span class="kw">select</span> <span class="fu">count</span>(<span class="kw">distinct</span> <span class="fu">uid</span>) <span class="kw">from</span> weibo_lite_ods1 <span class="kw">where</span> dt = ${<span class="dt">day</span>}


<span class="co">---refresh_uv</span>
<span class="kw">select</span> <span class="fu">count</span>(<span class="kw">distinct</span> <span class="fu">uid</span>) <span class="kw">from</span> weibo_lite_ods1 <span class="kw">where</span> dt = ${<span class="dt">day</span>} <span class="kw">and</span> action = <span class="st">&#39;2353&#39;</span> 


<span class="co">---refresh_pv</span>
<span class="kw">select</span> <span class="fu">count</span>(<span class="fu">uid</span>) <span class="kw">from</span> weibo_lite_ods1 <span class="kw">where</span> dt = ${<span class="dt">day</span>} <span class="kw">and</span> action = <span class="st">&#39;2353&#39;</span> 


<span class="co">---switch_uv</span>
<span class="kw">select</span> <span class="fu">count</span>(<span class="kw">distinct</span> <span class="fu">uid</span>) <span class="kw">from</span> weibo_lite_ods1 <span class="kw">where</span> dt = ${<span class="dt">day</span>} <span class="kw">and</span> action = <span class="st">&#39;2321&#39;</span>


<span class="co">---switch_pv</span>
<span class="kw">select</span> <span class="fu">count</span>(<span class="fu">uid</span>) <span class="kw">from</span> weibo_lite_ods1 <span class="kw">where</span> dt = ${<span class="dt">day</span>} <span class="kw">and</span> action = <span class="st">&#39;2321&#39;</span></code></pre></div>
</div>
</div>
<div id="section-3.2" class="section level2">
<h2><span class="header-section-number">3.2</span> 极速版数仓字典</h2>
<div id="section-3.2.1" class="section level3">
<h3><span class="header-section-number">3.2.1</span> 极速版打码日志(每日增量表)</h3>
<table>
<thead>
<tr class="header">
<th>字段名</th>
<th>字段描述</th>
<th>数据类型</th>
<th>数据实例</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>day_key</td>
<td>时间</td>
<td>string</td>
<td>23:00:00</td>
<td>行为发生时间</td>
</tr>
<tr class="even">
<td>uid</td>
<td>UID</td>
<td>string</td>
<td>1281231231</td>
<td>13位为访客10位为正式用户</td>
</tr>
<tr class="odd">
<td>aid</td>
<td>设备aid</td>
<td>string</td>
<td>　</td>
<td>　</td>
</tr>
<tr class="even">
<td>action</td>
<td>行为码</td>
<td>string</td>
<td>97</td>
<td>　</td>
</tr>
<tr class="odd">
<td>uicode</td>
<td>页面uicode</td>
<td>string</td>
<td>10000011</td>
<td>　</td>
</tr>
<tr class="even">
<td>luicode</td>
<td>上级页面uidcode</td>
<td>string</td>
<td>10000011</td>
<td>　</td>
</tr>
<tr class="odd">
<td>wm</td>
<td>wm值</td>
<td>string</td>
<td>4209_8001</td>
<td>　</td>
</tr>
<tr class="even">
<td>oldwm</td>
<td>初始wm值</td>
<td>string</td>
<td>4209_8002</td>
<td>　</td>
</tr>
<tr class="odd">
<td>extend</td>
<td>扩展字段</td>
<td>string</td>
<td>　</td>
<td>　</td>
</tr>
<tr class="even">
<td>fid</td>
<td>　</td>
<td>string</td>
<td>　</td>
<td>　</td>
</tr>
<tr class="odd">
<td>lfid</td>
<td>　</td>
<td>string</td>
<td>　</td>
<td>　</td>
</tr>
<tr class="even">
<td>from_val</td>
<td>from值</td>
<td>string</td>
<td>1041095010</td>
<td>　</td>
</tr>
<tr class="odd">
<td>dt</td>
<td>时间</td>
<td>string</td>
<td>20131-11-08</td>
<td>　</td>
</tr>
</tbody>
</table>
</div>
<div id="-1" class="section level3">
<h3><span class="header-section-number">3.2.2</span> 极速版用户注册信息表(每日增量表)</h3>
<table>
<thead>
<tr class="header">
<th>字段名</th>
<th>字段描述</th>
<th>数据类型</th>
<th>数据实例</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>uid</td>
<td>用户uid</td>
<td>String</td>
<td>10000011</td>
<td>有行为码2358的用户</td>
</tr>
<tr class="even">
<td>aid</td>
<td>设备aid</td>
<td>String</td>
<td>01AlwhaY0yxNx4TuiTIw2jweTC-OVGqSjZLjWr4qiOQrwZMRM.</td>
<td>　</td>
</tr>
<tr class="odd">
<td>reg_time</td>
<td>注册时间</td>
<td>String</td>
<td>41643.95833</td>
<td>　</td>
</tr>
<tr class="even">
<td>dt</td>
<td>时间</td>
<td></td>
<td>20131118</td>
<td>　</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="section-3.3" class="section level2">
<h2><span class="header-section-number">3.3</span> 极速版邮件调度</h2>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql">#!/bin/sh

day=`date -d <span class="ot">&quot;1 day ago&quot;</span> +%Y%m%d`
last_1=`date -d <span class="ot">&quot;${day} 1 days ago&quot;</span> +%Y%m%d`

hive -e<span class="ot">&quot;</span>

## 新增安装量和留存
<span class="kw">SELECT</span> oldwm,
       <span class="fu">count</span>(t1.aid) <span class="kw">AS</span> newdevice_cnt,
       <span class="fu">count</span>(t2.aid) <span class="kw">AS</span> tmr_retent_cnt,
       <span class="st">&#39;${day}&#39;</span>
<span class="kw">FROM</span>
  (<span class="kw">SELECT</span> a.aid,
          a.oldwm
   <span class="kw">FROM</span>
     (<span class="kw">SELECT</span> aid,
             oldwm
      <span class="kw">FROM</span> weibo_lite_ods1
      <span class="kw">WHERE</span> dt = <span class="st">&#39;${last_1}&#39;</span>
      <span class="kw">GROUP</span> <span class="kw">BY</span> aid,
               oldwm) a
   <span class="kw">LEFT</span> <span class="kw">JOIN</span>
     (<span class="kw">SELECT</span> aid
      <span class="kw">FROM</span> weibo_lite_ods1
      <span class="kw">WHERE</span> dt &lt; <span class="st">&#39;${last_1}&#39;</span>
      <span class="kw">GROUP</span> <span class="kw">BY</span> aid) b <span class="kw">ON</span> a.aid = b.aid
   <span class="kw">WHERE</span> b.aid <span class="kw">IS</span> <span class="kw">NULL</span>) t1
<span class="kw">LEFT</span> <span class="kw">JOIN</span>
  (<span class="kw">SELECT</span> aid
   <span class="kw">FROM</span> weibo_lite_ods1
   <span class="kw">WHERE</span> dt = <span class="st">&#39;${day}&#39;</span>
   <span class="kw">GROUP</span> <span class="kw">BY</span> aid) t2 <span class="kw">ON</span> t1.aid = t2.aid
<span class="kw">GROUP</span> <span class="kw">BY</span> oldwm


## feed 刷新次数/人数
<span class="kw">SELECT</span> <span class="fu">count</span>(<span class="fu">uid</span>) <span class="kw">AS</span> refresh_pv,
       <span class="fu">count</span>(<span class="kw">distinct</span> <span class="fu">uid</span>) <span class="kw">AS</span> refresh_uv,
       <span class="kw">TYPE</span>,
       <span class="st">&#39;${day}&#39;</span>
<span class="kw">FROM</span>
  (<span class="kw">SELECT</span> <span class="fu">uid</span>,
          <span class="kw">CASE</span>
              <span class="kw">WHEN</span> ((fid <span class="kw">LIKE</span> <span class="st">&#39;10001%&#39;</span>
                    <span class="kw">OR</span> fid <span class="kw">LIKE</span> <span class="st">&#39;10009%&#39;</span>
                    <span class="kw">OR</span> fid <span class="kw">LIKE</span> <span class="st">&#39;10010%&#39;</span>
                    <span class="kw">OR</span> fid <span class="kw">LIKE</span> <span class="st">&#39;10013%&#39;</span>
                    <span class="kw">OR</span> fid = <span class="st">&#39;friend_timeline&#39;</span>) <span class="kw">AND</span> uicode = <span class="st">&#39;10000613&#39;</span>) <span class="kw">THEN</span> <span class="st">&#39;guanzhu&#39;</span>
              <span class="kw">WHEN</span> fid <span class="kw">IN</span> (<span class="st">&#39;102803&#39;</span>,
                           <span class="st">&#39;same_city&#39;</span>,
                           <span class="st">&#39;102803_ctg1_7968_-_ctg1_7968&#39;</span>,
                           <span class="st">&#39;102803_ctg1_4388_-_ctg1_4388&#39;</span>,
                           <span class="st">&#39;102803_ctg1_1988_-_ctg1_1988&#39;</span>,
                           <span class="st">&#39;102803_ctg1_4288_-_ctg1_4288&#39;</span>,
                           <span class="st">&#39;102803_ctg1_4188_-_ctg1_4188&#39;</span>,
                           <span class="st">&#39;102803_ctg1_5088_-_ctg1_5088&#39;</span>,
                           <span class="st">&#39;102803_ctg1_1388_-_ctg1_1388&#39;</span>,
                           <span class="st">&#39;102803_ctg1_2288_-_ctg1_2288&#39;</span>,
                           <span class="st">&#39;102803_ctg1_5188_-_ctg1_5188&#39;</span>,
                           <span class="st">&#39;102803_ctg1_3288_-_ctg1_3288&#39;</span>,
                           <span class="st">&#39;102803_ctg1_4888_-_ctg1_4888&#39;</span>,
                           <span class="st">&#39;102803_ctg1_6288_-_ctg1_6288&#39;</span>,
                           <span class="st">&#39;102803_ctg1_2088_-_ctg1_2088&#39;</span>,
                           <span class="st">&#39;102803_ctg1_1288_-_ctg1_1288&#39;</span>,
                           <span class="st">&#39;102803_ctg1_5288_-_ctg1_5288&#39;</span>,
                           <span class="st">&#39;102803_ctg1_2388_-_ctg1_2388&#39;</span>,
                           <span class="st">&#39;102803_ctg1_6688_-_ctg1_6688&#39;</span>,
                           <span class="st">&#39;102803_ctg1_6388_-_ctg1_6388&#39;</span>,
                           <span class="st">&#39;102803_ctg1_6788_-_ctg1_6788&#39;</span>,
                           <span class="st">&#39;102803_ctg1_2688_-_ctg1_2688&#39;</span>,
                           <span class="st">&#39;102803_ctg1_4988_-_ctg1_4988&#39;</span>,
                           <span class="st">&#39;102803_ctg1_2488_-_ctg1_2488&#39;</span>,
                           <span class="st">&#39;102803_ctg1_4588_-_ctg1_4588&#39;</span>,
                           <span class="st">&#39;102803_ctg1_1488_-_ctg1_1488&#39;</span>,
                           <span class="st">&#39;102803_ctg1_5988_-_ctg1_5988&#39;</span>,
                           <span class="st">&#39;102803_ctg1_4788_-_ctg1_4788&#39;</span>,
                           <span class="st">&#39;102803_ctg1_4688_-_ctg1_4688&#39;</span>,
                           <span class="st">&#39;102803_ctg1_1588_-_ctg1_1588&#39;</span>,
                           <span class="st">&#39;102803_ctg1_2788_-_ctg1_2788&#39;</span>,
                           <span class="st">&#39;102803_ctg1_4488_-_ctg1_4488&#39;</span>,
                           <span class="st">&#39;102803_ctg1_7388_-_ctg1_7388&#39;</span>,
                           <span class="st">&#39;102803_ctg1_7088_-_ctg1_7088&#39;</span>,
                           <span class="st">&#39;102803_ctg1_5388_-_ctg1_5388&#39;</span>,
                           <span class="st">&#39;102803_ctg1_2588_-_ctg1_2588&#39;</span>,
                           <span class="st">&#39;102803_ctg1_5488_-_ctg1_5488&#39;</span>,
                           <span class="st">&#39;102803_ctg1_1688_-_ctg1_1688&#39;</span>,
                           <span class="st">&#39;102803_ctg1_5888_-_ctg1_5888&#39;</span>,
                           <span class="st">&#39;102803_ctg1_5588_-_ctg1_5588&#39;</span>,
                           <span class="st">&#39;102803_ctg1_6488_-_ctg1_6488&#39;</span>,
                           <span class="st">&#39;102803_ctg1_2188_-_ctg1_2188&#39;</span>,
                           <span class="st">&#39;102803_ctg1_6588_-_ctg1_6588&#39;</span>,
                           <span class="st">&#39;102803_ctg1_5688_-_ctg1_5688&#39;</span>,
                           <span class="st">&#39;102803_ctg1_6988_-_ctg1_6988&#39;</span>,
                           <span class="st">&#39;102803_ctg1_5788_-_ctg1_5788&#39;</span>,
                           <span class="st">&#39;102803_ctg1_3188_-_ctg1_3188&#39;</span>,
                           <span class="st">&#39;102803_ctg1_8788_-_ctg1_8788&#39;</span>,
                           <span class="st">&#39;102803_ctg1_8189_-_ctg1_8189&#39;</span>,
                           <span class="st">&#39;102803_ctg1_1788_-_ctg1_1788&#39;</span>,
                           <span class="st">&#39;102803_ctg1_7188_-_ctg1_7188&#39;</span>,
                           <span class="st">&#39;102803_ctg1_8999_-_ctg1_8999_home&#39;</span>,
                           <span class="st">&#39;102803_ctg1_8998_-_ctg1_8998&#39;</span>,
                           <span class="st">&#39;102803_ctg1_8997_-_ctg1_8997&#39;</span>,
                           <span class="st">&#39;102803_ctg1_9999_-_ctg1_9999&#39;</span>,
                           <span class="st">&#39;102803_ctg1_8899_-_ctg1_8899&#39;</span>,
                           <span class="st">&#39;102803_ctg1_8799_-_ctg1_8799&#39;</span>,
                           <span class="st">&#39;102803_ctg1_8698_-_ctg1_8698&#39;</span>) <span class="kw">THEN</span> <span class="st">&#39;remen&#39;</span>
              <span class="kw">WHEN</span> fid <span class="kw">IN</span> (<span class="st">&#39;231159&#39;</span>,
                           <span class="st">&#39;231159_video_tag_1&#39;</span>,
                           <span class="st">&#39;231159_video_tag_2&#39;</span>,
                           <span class="st">&#39;231159_video_tag_14&#39;</span>,
                           <span class="st">&#39;231159_video_tag_15&#39;</span>,
                           <span class="st">&#39;231159_video_tag_3&#39;</span>,
                           <span class="st">&#39;231159_video_tag_4&#39;</span>,
                           <span class="st">&#39;231159_video_tag_5&#39;</span>,
                           <span class="st">&#39;231159_video_tag_7&#39;</span>,
                           <span class="st">&#39;231159_video_tag_8&#39;</span>,
                           <span class="st">&#39;231159_video_tag_16&#39;</span>) <span class="kw">THEN</span> <span class="st">&#39;shipin&#39;</span>
              <span class="kw">ELSE</span> <span class="kw">NULL</span>
          <span class="kw">END</span> <span class="kw">AS</span> <span class="kw">TYPE</span>
   <span class="kw">FROM</span> weibo_lite_ods1
   <span class="kw">WHERE</span> dt = <span class="st">&#39;${day}&#39;</span>
     <span class="kw">AND</span> action = <span class="st">&#39;2353&#39;</span>)t1
<span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">TYPE</span>



## 频道top <span class="dv">5</span>

<span class="kw">SELECT</span> cnt, fid, <span class="kw">TYPE</span>, <span class="st">&#39;${day}&#39;</span>
<span class="kw">FROM</span>
(<span class="kw">SELECT</span> cnt, fid, <span class="kw">TYPE</span>, <span class="fu">row_number</span>() <span class="kw">over</span> (<span class="kw">partition</span> <span class="kw">by</span> <span class="kw">TYPE</span> <span class="kw">order</span> <span class="kw">by</span> cnt <span class="kw">desc</span>) <span class="kw">as</span> rn
<span class="kw">FROM</span>
(<span class="kw">SELECT</span> <span class="fu">count</span>(<span class="dv">1</span>) <span class="kw">as</span> cnt,
                    fid,
                    <span class="kw">TYPE</span>
<span class="kw">FROM</span>
(<span class="kw">SELECT</span> <span class="fu">uid</span>,
       fid,
       <span class="kw">CASE</span>
           <span class="kw">WHEN</span> ((fid <span class="kw">LIKE</span> <span class="st">&#39;10001%&#39;</span>
                  <span class="kw">OR</span> fid <span class="kw">LIKE</span> <span class="st">&#39;10009%&#39;</span>
                  <span class="kw">OR</span> fid <span class="kw">LIKE</span> <span class="st">&#39;10010%&#39;</span>
                  <span class="kw">OR</span> fid <span class="kw">LIKE</span> <span class="st">&#39;10013%&#39;</span>
                  <span class="kw">OR</span> fid = <span class="st">&#39;friend_timeline&#39;</span>)
                 <span class="kw">AND</span> uicode = <span class="st">&#39;10000613&#39;</span>) <span class="kw">THEN</span> <span class="st">&#39;guanzhu&#39;</span>
           <span class="kw">WHEN</span> fid <span class="kw">IN</span> (<span class="st">&#39;102803&#39;</span>,
                        <span class="st">&#39;same_city&#39;</span>,
                        <span class="st">&#39;102803_ctg1_7968_-_ctg1_7968&#39;</span>,
                        <span class="st">&#39;102803_ctg1_4388_-_ctg1_4388&#39;</span>,
                        <span class="st">&#39;102803_ctg1_1988_-_ctg1_1988&#39;</span>,
                        <span class="st">&#39;102803_ctg1_4288_-_ctg1_4288&#39;</span>,
                        <span class="st">&#39;102803_ctg1_4188_-_ctg1_4188&#39;</span>,
                        <span class="st">&#39;102803_ctg1_5088_-_ctg1_5088&#39;</span>,
                        <span class="st">&#39;102803_ctg1_1388_-_ctg1_1388&#39;</span>,
                        <span class="st">&#39;102803_ctg1_2288_-_ctg1_2288&#39;</span>,
                        <span class="st">&#39;102803_ctg1_5188_-_ctg1_5188&#39;</span>,
                        <span class="st">&#39;102803_ctg1_3288_-_ctg1_3288&#39;</span>,
                        <span class="st">&#39;102803_ctg1_4888_-_ctg1_4888&#39;</span>,
                        <span class="st">&#39;102803_ctg1_6288_-_ctg1_6288&#39;</span>,
                        <span class="st">&#39;102803_ctg1_2088_-_ctg1_2088&#39;</span>,
                        <span class="st">&#39;102803_ctg1_1288_-_ctg1_1288&#39;</span>,
                        <span class="st">&#39;102803_ctg1_5288_-_ctg1_5288&#39;</span>,
                        <span class="st">&#39;102803_ctg1_2388_-_ctg1_2388&#39;</span>,
                        <span class="st">&#39;102803_ctg1_6688_-_ctg1_6688&#39;</span>,
                        <span class="st">&#39;102803_ctg1_6388_-_ctg1_6388&#39;</span>,
                        <span class="st">&#39;102803_ctg1_6788_-_ctg1_6788&#39;</span>,
                        <span class="st">&#39;102803_ctg1_2688_-_ctg1_2688&#39;</span>,
                        <span class="st">&#39;102803_ctg1_4988_-_ctg1_4988&#39;</span>,
                        <span class="st">&#39;102803_ctg1_2488_-_ctg1_2488&#39;</span>,
                        <span class="st">&#39;102803_ctg1_4588_-_ctg1_4588&#39;</span>,
                        <span class="st">&#39;102803_ctg1_1488_-_ctg1_1488&#39;</span>,
                        <span class="st">&#39;102803_ctg1_5988_-_ctg1_5988&#39;</span>,
                        <span class="st">&#39;102803_ctg1_4788_-_ctg1_4788&#39;</span>,
                        <span class="st">&#39;102803_ctg1_4688_-_ctg1_4688&#39;</span>,
                        <span class="st">&#39;102803_ctg1_1588_-_ctg1_1588&#39;</span>,
                        <span class="st">&#39;102803_ctg1_2788_-_ctg1_2788&#39;</span>,
                        <span class="st">&#39;102803_ctg1_4488_-_ctg1_4488&#39;</span>,
                        <span class="st">&#39;102803_ctg1_7388_-_ctg1_7388&#39;</span>,
                        <span class="st">&#39;102803_ctg1_7088_-_ctg1_7088&#39;</span>,
                        <span class="st">&#39;102803_ctg1_5388_-_ctg1_5388&#39;</span>,
                        <span class="st">&#39;102803_ctg1_2588_-_ctg1_2588&#39;</span>,
                        <span class="st">&#39;102803_ctg1_5488_-_ctg1_5488&#39;</span>,
                        <span class="st">&#39;102803_ctg1_1688_-_ctg1_1688&#39;</span>,
                        <span class="st">&#39;102803_ctg1_5888_-_ctg1_5888&#39;</span>,
                        <span class="st">&#39;102803_ctg1_5588_-_ctg1_5588&#39;</span>,
                        <span class="st">&#39;102803_ctg1_6488_-_ctg1_6488&#39;</span>,
                        <span class="st">&#39;102803_ctg1_2188_-_ctg1_2188&#39;</span>,
                        <span class="st">&#39;102803_ctg1_6588_-_ctg1_6588&#39;</span>,
                        <span class="st">&#39;102803_ctg1_5688_-_ctg1_5688&#39;</span>,
                        <span class="st">&#39;102803_ctg1_6988_-_ctg1_6988&#39;</span>,
                        <span class="st">&#39;102803_ctg1_5788_-_ctg1_5788&#39;</span>,
                        <span class="st">&#39;102803_ctg1_3188_-_ctg1_3188&#39;</span>,
                        <span class="st">&#39;102803_ctg1_8788_-_ctg1_8788&#39;</span>,
                        <span class="st">&#39;102803_ctg1_8189_-_ctg1_8189&#39;</span>,
                        <span class="st">&#39;102803_ctg1_1788_-_ctg1_1788&#39;</span>,
                        <span class="st">&#39;102803_ctg1_7188_-_ctg1_7188&#39;</span>,
                        <span class="st">&#39;102803_ctg1_8999_-_ctg1_8999_home&#39;</span>,
                        <span class="st">&#39;102803_ctg1_8998_-_ctg1_8998&#39;</span>,
                        <span class="st">&#39;102803_ctg1_8997_-_ctg1_8997&#39;</span>,
                        <span class="st">&#39;102803_ctg1_9999_-_ctg1_9999&#39;</span>,
                        <span class="st">&#39;102803_ctg1_8899_-_ctg1_8899&#39;</span>,
                        <span class="st">&#39;102803_ctg1_8799_-_ctg1_8799&#39;</span>,
                        <span class="st">&#39;102803_ctg1_8698_-_ctg1_8698&#39;</span>) <span class="kw">THEN</span> <span class="st">&#39;remen&#39;</span>
           <span class="kw">WHEN</span> fid <span class="kw">IN</span> (<span class="st">&#39;231159&#39;</span>,
                        <span class="st">&#39;231159_video_tag_1&#39;</span>,
                        <span class="st">&#39;231159_video_tag_2&#39;</span>,
                        <span class="st">&#39;231159_video_tag_14&#39;</span>,
                        <span class="st">&#39;231159_video_tag_15&#39;</span>,
                        <span class="st">&#39;231159_video_tag_3&#39;</span>,
                        <span class="st">&#39;231159_video_tag_4&#39;</span>,
                        <span class="st">&#39;231159_video_tag_5&#39;</span>,
                        <span class="st">&#39;231159_video_tag_7&#39;</span>,
                        <span class="st">&#39;231159_video_tag_8&#39;</span>,
                        <span class="st">&#39;231159_video_tag_16&#39;</span>) <span class="kw">THEN</span> <span class="st">&#39;shipin&#39;</span>
           <span class="kw">ELSE</span> <span class="kw">NULL</span>
       <span class="kw">END</span> <span class="kw">AS</span> <span class="kw">TYPE</span>
<span class="kw">FROM</span> weibo_lite_ods1
<span class="kw">WHERE</span> dt = <span class="st">&#39;${day}&#39;</span>
  <span class="kw">AND</span> action = <span class="st">&#39;2353&#39;</span>)t1
<span class="kw">GROUP</span> <span class="kw">BY</span> fid, <span class="kw">TYPE</span>)t2)t3
<span class="kw">WHERE</span> rn &lt;= <span class="dv">5</span>
<span class="ot">&quot;</span></code></pre></div>
</div>
<div id="fid" class="section level2">
<h2><span class="header-section-number">3.4</span> 极速版FID</h2>
<div id="section-3.4.1" class="section level3">
<h3><span class="header-section-number">3.4.1</span> 关注</h3>
<table>
<thead>
<tr class="header">
<th>频道</th>
<th>containerid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>全部关注</td>
<td>10001</td>
</tr>
<tr class="even">
<td>好友圈（互相关注）</td>
<td>10009</td>
</tr>
<tr class="odd">
<td>群微博</td>
<td>10010</td>
</tr>
<tr class="even">
<td>V+微博</td>
<td>10013</td>
</tr>
<tr class="odd">
<td>时间序</td>
<td>friend_timeline</td>
</tr>
</tbody>
</table>
</div>
<div id="section-3.4.2" class="section level3">
<h3><span class="header-section-number">3.4.2</span> 热门</h3>
<table>
<thead>
<tr class="header">
<th>频道</th>
<th>containerid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>附近</td>
<td>same_city</td>
</tr>
<tr class="even">
<td>热门</td>
<td>102803</td>
</tr>
<tr class="odd">
<td>新时代</td>
<td>102803_ctg1_7968_-_ctg1_7968</td>
</tr>
<tr class="even">
<td>搞笑</td>
<td>102803_ctg1_4388_-_ctg1_4388</td>
</tr>
<tr class="odd">
<td>情感</td>
<td>102803_ctg1_1988_-_ctg1_1988</td>
</tr>
<tr class="even">
<td>明星</td>
<td>102803_ctg1_4288_-_ctg1_4288</td>
</tr>
<tr class="odd">
<td>社会</td>
<td>102803_ctg1_4188_-_ctg1_4188</td>
</tr>
<tr class="even">
<td>数码</td>
<td>102803_ctg1_5088_-_ctg1_5088</td>
</tr>
<tr class="odd">
<td>体育</td>
<td>102803_ctg1_1388_-_ctg1_1388</td>
</tr>
<tr class="even">
<td>美女模特</td>
<td>102803_ctg1_2288_-_ctg1_2288</td>
</tr>
<tr class="odd">
<td>汽车</td>
<td>102803_ctg1_5188_-_ctg1_5188</td>
</tr>
<tr class="even">
<td>电影</td>
<td>102803_ctg1_3288_-_ctg1_3288</td>
</tr>
<tr class="odd">
<td>游戏</td>
<td>102803_ctg1_4888_-_ctg1_4888</td>
</tr>
<tr class="even">
<td>国际</td>
<td>102803_ctg1_6288_-_ctg1_6288</td>
</tr>
<tr class="odd">
<td>科技</td>
<td>102803_ctg1_2088_-_ctg1_2088</td>
</tr>
<tr class="even">
<td>股市</td>
<td>102803_ctg1_1288_-_ctg1_1288</td>
</tr>
<tr class="odd">
<td>音乐</td>
<td>102803_ctg1_5288_-_ctg1_5288</td>
</tr>
<tr class="even">
<td>动漫</td>
<td>102803_ctg1_2388_-_ctg1_2388</td>
</tr>
<tr class="odd">
<td>军事</td>
<td>102803_ctg1_6688_-_ctg1_6688</td>
</tr>
<tr class="even">
<td>财经</td>
<td>102803_ctg1_6388_-_ctg1_6388</td>
</tr>
<tr class="odd">
<td>历史</td>
<td>102803_ctg1_6788_-_ctg1_6788</td>
</tr>
<tr class="even">
<td>美食</td>
<td>102803_ctg1_2688_-_ctg1_2688</td>
</tr>
<tr class="odd">
<td>美图</td>
<td>102803_ctg1_4988_-_ctg1_4988</td>
</tr>
<tr class="even">
<td>电视剧</td>
<td>102803_ctg1_2488_-_ctg1_2488</td>
</tr>
<tr class="odd">
<td>读书</td>
<td>102803_ctg1_4588_-_ctg1_4588</td>
</tr>
<tr class="even">
<td>校园</td>
<td>102803_ctg1_1488_-_ctg1_1488</td>
</tr>
<tr class="odd">
<td>科普</td>
<td>102803_ctg1_5988_-_ctg1_5988</td>
</tr>
<tr class="even">
<td>运动健身</td>
<td>102803_ctg1_4788_-_ctg1_4788</td>
</tr>
<tr class="odd">
<td>综艺</td>
<td>102803_ctg1_4688_-_ctg1_4688</td>
</tr>
<tr class="even">
<td>美妆</td>
<td>102803_ctg1_1588_-_ctg1_1588</td>
</tr>
<tr class="odd">
<td>萌宠</td>
<td>102803_ctg1_2788_-_ctg1_2788</td>
</tr>
<tr class="even">
<td>时尚</td>
<td>102803_ctg1_4488_-_ctg1_4488</td>
</tr>
<tr class="odd">
<td>法律</td>
<td>102803_ctg1_7388_-_ctg1_7388</td>
</tr>
<tr class="even">
<td>正能量</td>
<td>102803_ctg1_7088_-_ctg1_7088</td>
</tr>
<tr class="odd">
<td>设计</td>
<td>102803_ctg1_5388_-_ctg1_5388</td>
</tr>
<tr class="even">
<td>旅游</td>
<td>102803_ctg1_2588_-_ctg1_2588</td>
</tr>
<tr class="odd">
<td>艺术</td>
<td>102803_ctg1_5488_-_ctg1_5488</td>
</tr>
<tr class="even">
<td>星座</td>
<td>102803_ctg1_1688_-_ctg1_1688</td>
</tr>
<tr class="odd">
<td>家居</td>
<td>102803_ctg1_5888_-_ctg1_5888</td>
</tr>
<tr class="even">
<td>房产</td>
<td>102803_ctg1_5588_-_ctg1_5588</td>
</tr>
<tr class="odd">
<td>瘦身</td>
<td>102803_ctg1_6488_-_ctg1_6488</td>
</tr>
<tr class="even">
<td>健康</td>
<td>102803_ctg1_2188_-_ctg1_2188</td>
</tr>
<tr class="odd">
<td>养生</td>
<td>102803_ctg1_6588_-_ctg1_6588</td>
</tr>
<tr class="even">
<td>宗教</td>
<td>102803_ctg1_5688_-_ctg1_5688</td>
</tr>
<tr class="odd">
<td>辟谣</td>
<td>102803_ctg1_6988_-_ctg1_6988</td>
</tr>
<tr class="even">
<td>政务</td>
<td>102803_ctg1_5788_-_ctg1_5788</td>
</tr>
<tr class="odd">
<td>育儿</td>
<td>102803_ctg1_3188_-_ctg1_3188</td>
</tr>
<tr class="even">
<td>舞蹈</td>
<td>102803_ctg1_8788_-_ctg1_8788</td>
</tr>
<tr class="odd">
<td>收藏</td>
<td>102803_ctg1_8189_-_ctg1_8189</td>
</tr>
<tr class="even">
<td>婚庆</td>
<td>102803_ctg1_1788_-_ctg1_1788</td>
</tr>
<tr class="odd">
<td>三农</td>
<td>102803_ctg1_7188_-_ctg1_7188</td>
</tr>
<tr class="even">
<td>24小时榜</td>
<td>102803_ctg1_8999_-_ctg1_8999_home</td>
</tr>
<tr class="odd">
<td>男榜</td>
<td>102803_ctg1_8998_-_ctg1_8998</td>
</tr>
<tr class="even">
<td>女榜</td>
<td>102803_ctg1_8997_-_ctg1_8997</td>
</tr>
<tr class="odd">
<td>小时榜</td>
<td>102803_ctg1_9999_-_ctg1_9999</td>
</tr>
<tr class="even">
<td>昨日</td>
<td>102803_ctg1_8899_-_ctg1_8899</td>
</tr>
<tr class="odd">
<td>前日</td>
<td>102803_ctg1_8799_-_ctg1_8799</td>
</tr>
<tr class="even">
<td>周榜</td>
<td>102803_ctg1_8698_-_ctg1_8698</td>
</tr>
</tbody>
</table>
</div>
<div id="section-3.4.3" class="section level3">
<h3><span class="header-section-number">3.4.3</span> 视频</h3>
<table>
<thead>
<tr class="header">
<th>频道</th>
<th>containerid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>热门</td>
<td>231159</td>
</tr>
<tr class="even">
<td>搞笑</td>
<td>231159_video_tag_1</td>
</tr>
<tr class="odd">
<td>音乐</td>
<td>231159_video_tag_2</td>
</tr>
<tr class="even">
<td>时尚美妆</td>
<td>231159_video_tag_14</td>
</tr>
<tr class="odd">
<td>美食</td>
<td>231159_video_tag_15</td>
</tr>
<tr class="even">
<td>萌娃萌宠</td>
<td>231159_video_tag_3</td>
</tr>
<tr class="odd">
<td>明星综艺</td>
<td>231159_video_tag_4</td>
</tr>
<tr class="even">
<td>微天下</td>
<td>231159_video_tag_5</td>
</tr>
<tr class="odd">
<td>影视</td>
<td>231159_video_tag_7</td>
</tr>
<tr class="even">
<td>体育健身</td>
<td>231159_video_tag_8</td>
</tr>
<tr class="odd">
<td>旅游</td>
<td>231159_video_tag_16</td>
</tr>
</tbody>
</table>
</div>
<div id="section-3.4.4" class="section level3">
<h3><span class="header-section-number">3.4.4</span> 页面</h3>
<p>具体页面再用container_id区分： 1. 极速版的关注流、热门流、附近流、小视频是同一个页面，故都采用uicode=10000613 2. 所有正文页：uicode=10000617 3. 搜索页：uicode=10000620 4. 访客流多信息流：uicode=10000660 5. 公共的channel页面（找人 话题 榜单）：uicode=10000661</p>
</div>
</div>
<div id="action" class="section level2">
<h2><span class="header-section-number">3.5</span> 极速版action</h2>
<table style="width:100%;">
<colgroup>
<col width="18%" />
<col width="10%" />
<col width="61%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th>行为名</th>
<th>行为code</th>
<th align="center">行为简介</th>
<th align="right">前后台</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2036-点击注册按钮</td>
<td>2036</td>
<td align="center">点击注册按钮，在热门流、附近页、周边页中，通过uicode区分-from 彭婷-20170830</td>
<td align="right">前台</td>
</tr>
<tr class="even">
<td>2051-关注流-点击个人中心</td>
<td>2051</td>
<td align="center">关注流-点击个人中心-from 彭婷-20170830</td>
<td align="right">前台</td>
</tr>
<tr class="odd">
<td>2052-关注流-点击消息箱</td>
<td>2052</td>
<td align="center">关注流-点击消息箱-from 彭婷-20170830</td>
<td align="right">前台</td>
</tr>
<tr class="even">
<td>2053-关注流-点击搜索框</td>
<td>2053</td>
<td align="center">关注流-点击搜索框-from 彭婷-20170830</td>
<td align="right">前台</td>
</tr>
<tr class="odd">
<td>2056-点击评论</td>
<td>2056</td>
<td align="center">点击评论，在关注流、热门流、附近页、周边页、评论盖楼页（评论右下方评论按钮）、搜索结果综合页、客人态中都有，通过uicode区分-from 彭婷-20170830</td>
<td align="right">前台</td>
</tr>
<tr class="even">
<td>2057-点击分享</td>
<td>2057</td>
<td align="center">点击分享（与转评赞并列的分享按钮），在关注流、热门流、附近页、周边页、正文页、搜索结果综合页、客人态中都有，通过uicode区分-from 彭婷-20170830</td>
<td align="right">前台</td>
</tr>
<tr class="odd">
<td>2058-关注流-点击悬浮发布器</td>
<td>2058</td>
<td align="center">关注流-点击悬浮发布器-from 彭婷-20170830</td>
<td align="right">前台</td>
</tr>
<tr class="even">
<td>2059-点击流内用户头像</td>
<td>2059</td>
<td align="center">点击流内用户头像，在关注流、正文页、搜索结果综合页、搜索结果用户页、通知页都有，通过uicode区分-from 彭婷-20170830</td>
<td align="right">前台</td>
</tr>
<tr class="odd">
<td>2063-点击登录按钮</td>
<td>2063</td>
<td align="center">点击登录按钮，在热门流、附近页、周边页中，通过uicode区分-from 彭婷-20170830</td>
<td align="right">前台</td>
</tr>
<tr class="even">
<td>2321-极速版客户端前后台切换行为码</td>
<td>2321</td>
<td align="center">极速版客户端前后台切换行为码</td>
<td align="right">前台/后台</td>
</tr>
<tr class="odd">
<td>2112-视频播放</td>
<td>2112</td>
<td align="center">视频播放行为，在关注流、热门流、附近页、周边页、搜索结果综合页、主人态、客人态中都有，通过uicode区分-from 彭婷-20170904</td>
<td align="right">前台</td>
</tr>
<tr class="even">
<td>2113-点击图片</td>
<td>2113</td>
<td align="center">点击图片，在关注流、热门流、附近页、周边页、正文页、评论盖楼页、搜索结果综合页、主人态、客人态中都有，通过uicode区分-from 彭婷-20170904</td>
<td align="right">前台</td>
</tr>
<tr class="odd">
<td>点击底tab微博</td>
<td>2243</td>
<td align="center"></td>
<td align="right">前台</td>
</tr>
<tr class="even">
<td>点击底tab发现</td>
<td>2244</td>
<td align="center"></td>
<td align="right">前台</td>
</tr>
<tr class="odd">
<td>点击底tab视频</td>
<td>2245</td>
<td align="center"></td>
<td align="right">前台</td>
</tr>
<tr class="even">
<td>点击底tab消息</td>
<td>2246</td>
<td align="center"></td>
<td align="right">前台</td>
</tr>
<tr class="odd">
<td>邀请好友曝光</td>
<td>2256</td>
<td align="center"></td>
<td align="right">前台</td>
</tr>
<tr class="even">
<td>点击邀请好友</td>
<td>2257</td>
<td align="center"></td>
<td align="right">前台</td>
</tr>
<tr class="odd">
<td>2112-视频播放</td>
<td>2112</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td>2180-访客态顶导TAB横滑</td>
<td>2180</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td>2358-注册成功</td>
<td>2358</td>
<td align="center">ext : 1）reg_type，表示注册方式，=qq（qq注册），=weixin（微信注册），=phone（手机号注册）</td>
<td align="right"></td>
</tr>
<tr class="even">
<td>2054-点击博文</td>
<td>2054</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td>2078-点击分享至微信</td>
<td>2078</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td>2079-点击分享至微信朋友圈</td>
<td>2079</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td>2080-点击分享至QQ</td>
<td>2080</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td>2081-点击分享至QQ空间</td>
<td>2081</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td>2039-正文页-点击右上角“更多”</td>
<td>2039</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td>2040-点击博文的转发列表</td>
<td>2040</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td>2041-点击博文的评论列表</td>
<td>2041</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td>2042-点击博文收获的赞列表</td>
<td>2042</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td>搜索环节-点击搜索框</td>
<td>2071</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td>2072-搜索页-点击微博热搜榜</td>
<td>2072</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td>2073-搜索页-点击热搜索具体排行</td>
<td>2073</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td>2076-搜索结果用户页-点击综合按钮</td>
<td>2076</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td>2082-通知页-点击返回</td>
<td>2082</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td>2085-profile-点击返回</td>
<td>2085</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td>2050-发布器页-点击返回</td>
<td>2050</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td>搜索环节-点击返回</td>
<td>2070</td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td>刷新行为</td>
<td>2353</td>
<td align="center">“在关注流、热门流、视频流、附近页、搜索结果页、profile都有，通过uicode区分-from 彭婷-20180104.<br>ext: 1）is_act，表示用户刷新流操作，=0（被动刷新）、=1（主动刷新）；2）load_type，表示刷feed方式，=pull（上拉刷新），=load_more（后向加载）”</td>
<td align="right"></td>
</tr>
</tbody>
</table>
</div>
<div id="section-3.6" class="section level2">
<h2><span class="header-section-number">3.6</span> 极速版互动（转评赞）</h2>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> <span class="fu">count</span>(a.uid),
       a.fid
<span class="kw">FROM</span> (
<span class="kw">SELECT</span> <span class="fu">uid</span>,
       <span class="kw">split</span>(<span class="kw">split</span>(extend, <span class="st">&#39;containerid:&#39;</span>)[<span class="dv">1</span>], <span class="st">&#39;</span><span class="ch">\\</span><span class="st">;&#39;</span>)[<span class="dv">0</span>] <span class="kw">AS</span> fid
<span class="kw">FROM</span> mds_bhv_pubblog
<span class="kw">WHERE</span> dt =<span class="st">&#39;${day[$i]}&#39;</span>
  <span class="kw">AND</span> is_transmit=<span class="st">&#39;1&#39;</span>
  <span class="kw">AND</span> <span class="kw">split</span>(<span class="kw">split</span>(extend, <span class="st">&#39;containerid:&#39;</span>)[<span class="dv">1</span>], <span class="st">&#39;</span><span class="ch">\\</span><span class="st">;&#39;</span>)[<span class="dv">0</span>] <span class="kw">IN</span> (<span class="st">&#39;901802&#39;</span>,
                                                            <span class="st">&#39;901802_attention_tag_1&#39;</span>,
                                                            <span class="st">&#39;901802_attention_tag_2&#39;</span>,
                                                            <span class="st">&#39;901802_attention_tag_3&#39;</span>,
                                                            <span class="st">&#39;901802_attention_tag_4&#39;</span>,
                                                            <span class="st">&#39;901802_attention_tag_5&#39;</span>,
                                                            <span class="st">&#39;901802_attention_tag_15&#39;</span>,
                                                            <span class="st">&#39;901802_attention_tag_16&#39;</span>,
                                                            <span class="st">&#39;901802_attention_tag_17&#39;</span>,
                                                            <span class="st">&#39;901802_attention_tag_18&#39;</span>,
                                                            <span class="st">&#39;901802_attention_tag_19&#39;</span>,
                                                            <span class="st">&#39;901802_attention_tag_20&#39;</span>,
                                                            <span class="st">&#39;102803&#39;</span>,
                                                            <span class="st">&#39;2311460031&#39;</span>,
                                                            <span class="st">&#39;2312610001&#39;</span>,
                                                            <span class="st">&#39;102803_ctg1_4388_-_ctg1_4388&#39;</span>,
                                                            <span class="st">&#39;102803_ctg1_1988_-_ctg1_1988&#39;</span>,
                                                            <span class="st">&#39;102803_ctg1_4288_-_ctg1_4288&#39;</span>,
                                                            <span class="st">&#39;102803_ctg1_4188_-_ctg1_4188&#39;</span>,
                                                            <span class="st">&#39;102803_ctg1_5088_-_ctg1_5088&#39;</span>,
                                                            <span class="st">&#39;102803_ctg1_1388_-_ctg1_1388&#39;</span>,
                                                            <span class="st">&#39;102803_ctg1_2288_-_ctg1_2288&#39;</span>,
                                                            <span class="st">&#39;102803_ctg1_5188_-_ctg1_5188&#39;</span>,
                                                            <span class="st">&#39;102803_ctg1_3288_-_ctg1_3288&#39;</span>,
                                                            <span class="st">&#39;102803_ctg1_4888_-_ctg1_4888&#39;</span>,
                                                            <span class="st">&#39;231159&#39;</span>,
                                                            <span class="st">&#39;231159_video_tag_1&#39;</span>,
                                                            <span class="st">&#39;231159_video_tag_2&#39;</span>,
                                                            <span class="st">&#39;231159_video_tag_14&#39;</span>,
                                                            <span class="st">&#39;231159_video_tag_15&#39;</span>,
                                                            <span class="st">&#39;231159_video_tag_3&#39;</span>,
                                                            <span class="st">&#39;231159_video_tag_4&#39;</span>,
                                                            <span class="st">&#39;231159_video_tag_5&#39;</span>,
                                                            <span class="st">&#39;231159_video_tag_7&#39;</span>,
                                                            <span class="st">&#39;231159_video_tag_8&#39;</span>,
                                                            <span class="st">&#39;231159_video_tag_16&#39;</span>)
  <span class="kw">AND</span> <span class="kw">split</span>(<span class="kw">split</span>(extend, <span class="st">&#39;from:&#39;</span>)[<span class="dv">1</span>], <span class="st">&#39;</span><span class="ch">\\</span><span class="st">;&#39;</span>)[<span class="dv">0</span>] <span class="kw">LIKE</span> <span class="st">&#39;25%&#39;</span>
<span class="kw">UNION</span> <span class="kw">ALL</span>
<span class="kw">SELECT</span> <span class="fu">uid</span>,
       <span class="kw">split</span>(<span class="kw">split</span>(extend, <span class="st">&#39;fid:&#39;</span>)[<span class="dv">1</span>], <span class="st">&#39;</span><span class="ch">\\</span><span class="st">;&#39;</span>)[<span class="dv">0</span>] <span class="kw">AS</span> fid
<span class="kw">FROM</span> mds_bhv_like
<span class="kw">WHERE</span> dt =<span class="st">&#39;${day[$i]}&#39;</span>
  <span class="kw">AND</span> MODE=<span class="st">&#39;1&#39;</span>
  <span class="kw">AND</span> <span class="kw">split</span>(<span class="kw">split</span>(extend, <span class="st">&#39;fid:&#39;</span>)[<span class="dv">1</span>], <span class="st">&#39;</span><span class="ch">\\</span><span class="st">;&#39;</span>)[<span class="dv">0</span>] <span class="kw">IN</span> (<span class="st">&#39;901802&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_1&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_2&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_3&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_4&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_5&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_15&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_16&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_17&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_18&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_19&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_20&#39;</span>,
                                                    <span class="st">&#39;102803&#39;</span>,
                                                    <span class="st">&#39;2311460031&#39;</span>,
                                                    <span class="st">&#39;2312610001&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_4388_-_ctg1_4388&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_1988_-_ctg1_1988&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_4288_-_ctg1_4288&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_4188_-_ctg1_4188&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_5088_-_ctg1_5088&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_1388_-_ctg1_1388&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_2288_-_ctg1_2288&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_5188_-_ctg1_5188&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_3288_-_ctg1_3288&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_4888_-_ctg1_4888&#39;</span>,
                                                    <span class="st">&#39;231159&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_1&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_2&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_14&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_15&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_3&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_4&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_5&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_7&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_8&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_16&#39;</span>)
  <span class="kw">AND</span> <span class="kw">split</span>(<span class="kw">split</span>(extend, <span class="st">&#39;from:&#39;</span>)[<span class="dv">1</span>], <span class="st">&#39;</span><span class="ch">\\</span><span class="st">;&#39;</span>)[<span class="dv">0</span>] <span class="kw">LIKE</span> <span class="st">&#39;25%&#39;</span>
<span class="kw">UNION</span> <span class="kw">ALL</span>
<span class="kw">SELECT</span> <span class="fu">uid</span>,
       <span class="kw">split</span>(<span class="kw">split</span>(extend, <span class="st">&#39;fid:&#39;</span>)[<span class="dv">1</span>], <span class="st">&#39;</span><span class="ch">\\</span><span class="st">;&#39;</span>)[<span class="dv">0</span>] <span class="kw">AS</span> fid
<span class="kw">FROM</span> mds_bhv_cmtblog
<span class="kw">WHERE</span> dt =<span class="st">&#39;${day[$i]}&#39;</span>
  <span class="kw">AND</span> <span class="kw">split</span>(<span class="kw">split</span>(extend, <span class="st">&#39;fid:&#39;</span>)[<span class="dv">1</span>], <span class="st">&#39;</span><span class="ch">\\</span><span class="st">;&#39;</span>)[<span class="dv">0</span>] <span class="kw">IN</span> (<span class="st">&#39;901802&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_1&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_2&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_3&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_4&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_5&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_15&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_16&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_17&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_18&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_19&#39;</span>,
                                                    <span class="st">&#39;901802_attention_tag_20&#39;</span>,
                                                    <span class="st">&#39;102803&#39;</span>,
                                                    <span class="st">&#39;2311460031&#39;</span>,
                                                    <span class="st">&#39;2312610001&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_4388_-_ctg1_4388&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_1988_-_ctg1_1988&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_4288_-_ctg1_4288&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_4188_-_ctg1_4188&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_5088_-_ctg1_5088&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_1388_-_ctg1_1388&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_2288_-_ctg1_2288&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_5188_-_ctg1_5188&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_3288_-_ctg1_3288&#39;</span>,
                                                    <span class="st">&#39;102803_ctg1_4888_-_ctg1_4888&#39;</span>,
                                                    <span class="st">&#39;231159&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_1&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_2&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_14&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_15&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_3&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_4&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_5&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_7&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_8&#39;</span>,
                                                    <span class="st">&#39;231159_video_tag_16&#39;</span>)
  <span class="kw">AND</span> <span class="kw">split</span>(<span class="kw">split</span>(extend, <span class="st">&#39;from:&#39;</span>)[<span class="dv">1</span>], <span class="st">&#39;</span><span class="ch">\\</span><span class="st">;&#39;</span>)[<span class="dv">0</span>] <span class="kw">LIKE</span> <span class="st">&#39;25%&#39;</span>) a
<span class="kw">GROUP</span> <span class="kw">BY</span> a.fid</code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="freq-sql.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02-Topspeed.Rmd",
"text": "Edit"
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
